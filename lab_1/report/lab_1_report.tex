%% The comment character in TeX / LaTeX is the percent character.
%% The following chunk is called the header

\documentclass{article}	% essential first line
\usepackage{times}		% this uses fonts which will look nice in PDF format
\usepackage{graphicx}		% needed for the figures
\usepackage{url}
\usepackage{adjustbox}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=Java,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}

%% Set the folder where pictures are located
\graphicspath{ {images/} }

%% Here I adjust the margins

\oddsidemargin -0.25in		% Left margin is 1in + this value
\textwidth 6.75in		% Right margin is not set explicitly
\topmargin 0in			% Top margin is 1in + this value
\textheight 9in			% Bottom margin is not set explicitly
\columnsep 0.25in		% separation between columns

%% Define a macro for inserting postscript images
%% ==============================================
%% This is a macro which nominally takes 3 parameters, 
%% it would be used as follows to insert and encapsulated postscript
%% image at the location where it is used.
%%
%% \EPSFIG{epsfilename}{caption}{label}
%% - epsfilename is the name of the encapsulated postscript file to be
%%               inserted at this location
%% - caption is the text to be shown as the figure caption, it will be
%%           prepended by Figure X.  The number X can be referenced
%%           using the label parameter.
%% - label is a name given to the figure, it can be referenced using the
%%         \ref{label} command.

%\def\EPSFIG[#1]#2#3#4{		% Don't be scared by this monsrosity
%\begin{figure}[hbt]		% it is a macro to save typing later
%\begin{center}			% 
%\includegraphics[#1]{#2}	%
%\end{center}			%
%\caption{#3}			%
%\label{#4}			%
%\end{figure}			%
%}				%

%% Define the fields to be displayed by a \maketitle command
\author{Timothy Dee, Brent Barth}
%{\it Undergraduate, Department of Electrical and Computer Engineering, Iowa State University}
%\author{Brent Barth}
%\it Undergraduate, Department of Electrical and Computer Engineering, Iowa State University}
\title{Lab 1 Report}

%%
%% Header now finished
%%

\begin{document}		% Critical
\twocolumn
\thispagestyle{empty}		% Inhibit the page number on this page
\maketitle			% Use the \author, \title and \date info

%% Next comes the abstract, notice the curly-braces surrounding the
%% text.

\abstract{This report contains a description and analysis of the findings durring Lab 1 of CprE 458, Real Time Systems. Contained herein is all relevent program code, and the results from having run this code.}

\section{Introduction}
TODO

\section{Part 1 - Code}
\subsection{High Performance Mode}
\begin{lstlisting}[float=*, caption={High Performance Mode},label={lst:HPM},numbers=left]
PMbutton2.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View v) {

				OPERATIONmessage("[High Performance Mode] ###########################################");
				//TODO Please program for High Performance Mode here (done)

				DATAname = "1300000"; // Setting up the minimum frequency 1300 Mhz
				DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
				ChangeCPUinfor(CPUname, DATAname, DATAaddress);
				DATAname = "1300000"; // Setting up the maximum frequency at 1300 MHz
				DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
				ChangeCPUinfor(CPUname, DATAname, DATAaddress);

				CPUname = "High Power";
				DATAname = "current min frequency";
				DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
				ReadCPUinfor(CPUname, DATAname, DATAaddress);
				DATAname = "current MAX frequency";
				DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
				ReadCPUinfor(CPUname, DATAname, DATAaddress);

				OPERATIONmessage("[High Performance Mode] ###########################################");


			}
		});
\end{lstlisting}
TODO

\subsection{Dynamic Frequency Scaling Mode I}
\begin{lstlisting}[float=*,caption={Dynamic Frequency Scaling Mode I},label={lst:DFS_1},numbers=left]
private void setDFS_1(double cpu_load){
		// determine if I should go to a power mode
		if(cpu_load < .2){
			// go to low performance mode
			PMbutton1.performClick();
		}else if(cpu_load > .9){
			//go to high performance mode
			PMbutton2.performClick();
		}else{
			// set the frequency range between 51 Mhz and 1.3 Ghz
			DATAname = "51000"; // Setting up the minimum frequency 51 Mhz
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
			ChangeCPUinfor(CPUname, DATAname, DATAaddress);
			DATAname = "1300000"; // Setting up the maximum frequency at 1300 MHz
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
			ChangeCPUinfor(CPUname, DATAname, DATAaddress);

			CPUname = "Dynamic Mode";
			DATAname = "current min frequency";
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
			ReadCPUinfor(CPUname, DATAname, DATAaddress);
			DATAname = "current MAX frequency";
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
			ReadCPUinfor(CPUname, DATAname, DATAaddress);
		}
	}
\end{lstlisting}
TODO

\subsection{Dynamic Frequency Scaling Mode II}
\begin{lstlisting}[float=*,caption={Dynamic Frequency Scaling Mode II},label={lst:DFS_2},numbers=left]
private void setDFS_2(){
		// get the battery level
		IntentFilter ifilter = new IntentFilter(Intent.ACTION_BATTERY_CHANGED);
		Intent batteryStatus = this.registerReceiver(null, ifilter);

		int level = batteryStatus.getIntExtra(BatteryManager.EXTRA_LEVEL, -1);
		int scale = batteryStatus.getIntExtra(BatteryManager.EXTRA_SCALE, -1);

		float battery_percent = level / (float)scale;

		// get the wireless radio state
		ConnectivityManager connectivityManager = (ConnectivityManager)
				this.getSystemService(Context.CONNECTIVITY_SERVICE);

		NetworkInfo network_info = connectivityManager.getActiveNetworkInfo();
		boolean is_wireless_on = (network_info != null);

		// get the charging state
		int status = batteryStatus.getIntExtra(BatteryManager.EXTRA_STATUS, -1);
		boolean is_charging = status == BatteryManager.BATTERY_STATUS_CHARGING ||
				status == BatteryManager.BATTERY_STATUS_FULL;

		//(continued on next page)		
\end{lstlisting}
\begin{lstlisting}[float=*,caption={Dynamic Frequency Scaling Mode II (continued)},label={lst:DFS_2_2},numbers=left]
// determine if we are charging
		if(is_charging){
			// if we are charging we don't care about power usage.... set to high performance mode
			PMbutton2.performClick();
		}else if(battery_percent < .3) {
			// we want to conserve energy because we are almost out of it, set to low performance mode
			PMbutton1.performClick();
		}else{
				// if we're not charging and not low battery we have some decisions to make
				// if the wireless radio is on we are likely doing something online.
				// If we are doing something we will like a more responsive device
				// so allow the processor to vary between two fairly high frequency states
				if (is_wireless_on) {
					// set to fairly high processing state
					// set the frequency range between 700 Mhz and 1.3 Ghz
					DATAname = "700000"; // Setting up the minimum frequency 51 Mhz
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
					ChangeCPUinfor(CPUname, DATAname, DATAaddress);
					DATAname = "1300000"; // Setting up the maximum frequency at 1300 MHz
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
					ChangeCPUinfor(CPUname, DATAname, DATAaddress);

					CPUname = "Dynamic Mode";
					DATAname = "current min frequency";
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
					ReadCPUinfor(CPUname, DATAname, DATAaddress);
					DATAname = "current MAX frequency";
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
					ReadCPUinfor(CPUname, DATAname, DATAaddress);
				} else {
					// set to lower processing state
					// set the frequency range between 51 Mhz and 700 Mhz
					DATAname = "51000"; // Setting up the minimum frequency 51 Mhz
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
					ChangeCPUinfor(CPUname, DATAname, DATAaddress);
					DATAname = "700000"; // Setting up the maximum frequency at 1300 MHz
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
					ChangeCPUinfor(CPUname, DATAname, DATAaddress);

					CPUname = "Dynamic Mode";
					DATAname = "current min frequency";
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
					ReadCPUinfor(CPUname, DATAname, DATAaddress);
					DATAname = "current MAX frequency";
					DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
					ReadCPUinfor(CPUname, DATAname, DATAaddress);
				}
		}
	}
\end{lstlisting}
TODO

\subsection{Dynamic Frequency Scaling Mode Mixed}
\begin{lstlisting}[float=*,caption={Dynamic Frequency Scaling Mode Mixed},label={lst:DFS_mixed},numbers=left]
private void setDFS_Mixed(double cpu_load) {
		// get the battery level
		IntentFilter ifilter = new IntentFilter(Intent.ACTION_BATTERY_CHANGED);
		Intent batteryStatus = this.registerReceiver(null, ifilter);

		int level = batteryStatus.getIntExtra(BatteryManager.EXTRA_LEVEL, -1);
		int scale = batteryStatus.getIntExtra(BatteryManager.EXTRA_SCALE, -1);

		float battery_percent = level / (float)scale;

		// get the charging state
		int status = batteryStatus.getIntExtra(BatteryManager.EXTRA_STATUS, -1);
		boolean is_charging = status == BatteryManager.BATTERY_STATUS_CHARGING ||
				status == BatteryManager.BATTERY_STATUS_FULL;

		// determine if we are charging
		if(is_charging){
			// if we are charging we don't care about power usage.... set to high performance mode
			PMbutton2.performClick();
		}else {
			// vary the processor frequency based on the battery level.
			// the higher the battery level, the higher the frequency.
			// anywhere from 100000 khz to 1300000 khz
			double step_size = 100.0/13.0;
			int load_fraction = new Double(Math.ceil(battery_percent / step_size)).intValue();

			// load_fraction is at greatest 1
			int high_frequency = 100000 * Integer.valueOf(load_fraction * 13);
			int low_frequency = high_frequency;

			// set to fairly high processing state
			// set the frequency range between 700 Mhz and 1.3 Ghz
			DATAname = String.valueOf(low_frequency); // Setting up the minimum frequency at low frequency
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
			ChangeCPUinfor(CPUname, DATAname, DATAaddress);
			DATAname = String.valueOf(high_frequency); // Setting up the maximum frequency at high frequency
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
			ChangeCPUinfor(CPUname, DATAname, DATAaddress);

			CPUname = "Dynamic Mode";
			DATAname = "current min frequency";
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq";
			ReadCPUinfor(CPUname, DATAname, DATAaddress);
			DATAname = "current MAX frequency";
			DATAaddress = "/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq";
			ReadCPUinfor(CPUname, DATAname, DATAaddress);
		}
	}
\end{lstlisting}
TODO

%we should say how we did each of the tests. We should also say what we used to generate each of the loads.
\section{Part 2 - Data Analysis}
%possibly insert a table indicating what energy consumption we got for each energy scheme under each load.
%might also be useful to include description of the testing.
%must include graphs of each test result
\subsection{Measuring energy consumption}
TODO

\subsection{Comparison and Analysis}
TODO

\section{Extra Part - Measuring Computation Time}
TODO

% example figure
\begin{figure}[!hbt]
\begin{center}
\includegraphics[width=.4\textwidth,keepaspectratio]{example.png}
\end{center}
\caption{IR-Transmitter}
\label{FIG-TRANSMITTER}
\end{figure}

% example equation
\begin{equation}
\begin{split}
\frac{V_{out}-V_-}{R2}-\frac{V_--V_{in}}{R1}=0 \\
R1(V_{out}-V_-)=R2(V_--V_{in}) \\
V_{out}=\frac{R1V_-+R2V_--R2V{in}}{R1} \\
V_-=0 \\
V_{out}=\frac{-V_{in}R2}{R1} \\
\frac{V_{out}}{V_{in}}=\frac{-R2}{R1} \\ \\
\hline \\
\frac{V_{out}}{V_{in}}=\frac{47000}{47}=1000 \\
\end{split}
\label{eq-example}
\end{equation}
Equation \ref{eq-example} demonstrates example equation.

%% This bit generates the references.  This part starts to get
%% slightly tricky.
\bibliographystyle{unsrt}	% Order by citation
\bibliography{report}

\end{document}
